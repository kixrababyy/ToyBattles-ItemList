<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToyBattles Item Database</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>:root{--bg:#0b0d12;--bg2:#10131a;--bg3:#161a24;--surface:#1c2030;--surface2:#222638;--border:#253040;--border2:#344060;--text:#f0f4ff;--text2:#9ba8c8;--text3:#566080;--accent:#29ABE2;--accent2:#FFB800;--tb-blue:#29ABE2;--tb-gold:#FFB800;--tb-black:#111418;--radius:8px}[data-theme="light"]{--bg:#eef2f8;--bg2:#e0e6f0;--bg3:#d4dcea;--surface:#ffffff;--surface2:#edf1fa;--border:#c8d0e8;--border2:#adb8d8;--text:#111828;--text2:#3d4a70;--text3:#7a88a8;--accent:#29ABE2;--accent2:#e09000}*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background .3s,color .3s}#loading-screen{position:fixed;inset:0;z-index:300;background:var(--bg);background-image:url('assets/background.webp');background-size:cover;background-position:center;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;transition:opacity .4s}#loading-screen::before{content:'';position:absolute;inset:0;background:rgba(10,12,18,.82);backdrop-filter:blur(4px)}#loading-screen>*{position:relative;z-index:1}#loading-screen.fade-out{opacity:0;pointer-events:none}.load-logo{display:flex;flex-direction:column;align-items:center;gap:14px}.load-logo img{height:100px;width:auto;filter:drop-shadow(0 0 20px rgba(41,171,226,.6));animation:logoFloat 3s ease-in-out infinite}.load-logo-text{font-family:'Bangers',cursive;font-size:28px;letter-spacing:2px;color:var(--text2)}@keyframes logoFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}.load-steps{display:flex;flex-direction:column;gap:10px;width:340px}.load-step{display:flex;align-items:center;gap:12px;font-size:13px;color:var(--text3);transition:color .3s}.load-step.active{color:var(--text2)}.load-step.done{color:#6fcf82}.step-dot{width:8px;height:8px;border-radius:50%;background:var(--border2);flex-shrink:0;transition:background .3s}.load-step.active .step-dot{background:var(--accent2);animation:pulse 1s infinite}.load-step.done .step-dot{background:#6fcf82}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}.load-bar-wrap{width:340px;height:4px;background:var(--border);border-radius:2px;overflow:hidden}.load-bar{height:100%;width:0;background:linear-gradient(90deg,var(--tb-blue),var(--tb-gold));transition:width .4s ease;border-radius:2px}.load-error{color:#ff8888;font-size:14px;font-weight:600;text-align:center;max-width:340px;background:rgba(180,40,40,.25);border:1px solid rgba(255,100,100,.4);border-radius:8px;padding:10px 14px;display:none}.retry-btn{margin-top:10px;padding:8px 20px;background:var(--surface);border:1px solid var(--border2);color:var(--text);border-radius:var(--radius);cursor:pointer;font-size:13px;font-family:'Barlow',sans-serif;transition:border-color .2s;display:none}.retry-btn:hover{border-color:var(--accent2)}.site-hero{position:relative;overflow:hidden;background:#0a0c14;border-bottom:3px solid var(--tb-gold)}.site-hero-bg{position:absolute;inset:0;background-image:url('assets/background.webp');background-size:cover;background-position:center 30%;opacity:.28;filter:saturate(.7)}.site-hero-overlay{position:absolute;inset:0;background:linear-gradient(
to bottom,rgba(10,12,20,.55) 0%,rgba(10,12,20,.82) 80%,rgba(10,12,20,1) 100%
)}.site-hero-inner{position:relative;z-index:2;max-width:1600px;margin:0 auto;padding:22px 28px 18px;display:flex;align-items:center;gap:20px}.site-logo{height:72px;width:auto;object-fit:contain;flex-shrink:0;filter:drop-shadow(0 2px 12px rgba(41,171,226,.35))}.site-title-block{display:flex;flex-direction:column;gap:2px}.site-title{font-family:'Bangers',cursive;font-size:38px;letter-spacing:2px;line-height:1;color:#fff;text-shadow:0 0 20px rgba(41,171,226,.5),2px 2px 0 rgba(0,0,0,.8)}.site-title .gold{color:var(--tb-gold)}.site-subtitle{font-family:'Nunito',sans-serif;font-size:12px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:var(--tb-blue);opacity:.85}.hero-btn{display:inline-flex;align-items:center;gap:7px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:8px 16px;cursor:pointer;font-family:'Nunito',sans-serif;font-size:12px;font-weight:700;color:rgba(255,255,255,.85);transition:all .18s;white-space:nowrap;backdrop-filter:blur(6px);letter-spacing:.4px;text-transform:uppercase}.hero-btn svg{flex-shrink:0;transition:transform .35s}.hero-btn:hover{background:rgba(41,171,226,.22);border-color:var(--tb-blue);color:#fff}.hero-btn.reload-btn:hover svg{transform:rotate(180deg)}.hero-btn.theme-btn{gap:6px}.hero-btn.theme-btn:hover{background:rgba(255,184,0,.18);border-color:var(--tb-gold)}.variants-grid-drawer{display:none;margin-top:6px;border-top:1px solid var(--border);padding-top:8px;flex-wrap:wrap;gap:5px}.variants-grid-drawer.open{display:flex}.vc-chip{display:flex;flex-direction:row;align-items:center;gap:6px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:5px 8px;cursor:pointer;transition:border-color .12s,background .12s;min-width:0}.vc-chip:hover{border-color:var(--cat-color,var(--tb-blue));background:var(--surface2)}.vc-chip .chip-info{display:flex;flex-direction:column;gap:1px;min-width:0}.vc-chip .chip-label{font-size:10px;color:var(--text2);line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:110px}.stats-bar{background:var(--bg2);border-bottom:1px solid var(--border);padding:8px 24px}.stats-inner{max-width:1600px;margin:0 auto;display:flex;gap:24px;align-items:center;flex-wrap:wrap}.stat{display:flex;align-items:baseline;gap:6px}.stat-num{font-family:'Share Tech Mono',monospace;font-size:19px;font-weight:700;color:var(--accent2)}.stat-label{font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:1px}.controls{background:var(--bg2);border-bottom:1px solid var(--border);padding:10px 24px;position:sticky;top:0;z-index:90}.controls-inner{max-width:1600px;margin:0 auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}.search-wrap{position:relative;flex:1;min-width:180px}.search-wrap svg{position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--text3);pointer-events:none}#search{width:100%;padding:7px 10px 7px 30px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-family:'Nunito',sans-serif;font-size:13px;outline:none;transition:border-color .2s}#search:focus{border-color:var(--accent2)}#search::placeholder{color:var(--text3)}select{background:var(--surface);border:1px solid var(--border);color:var(--text);border-radius:var(--radius);font-family:'Nunito',sans-serif;font-size:13px;padding:7px 10px;cursor:pointer;outline:none;transition:border-color .2s}select:hover,select:focus{border-color:var(--accent2)}option{background:var(--surface)}.view-toggle{display:flex;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}.view-btn{background:var(--surface);border:none;border-right:1px solid var(--border);color:var(--text2);padding:7px 12px;cursor:pointer;font-size:13px;transition:all .15s}.view-btn:last-child{border-right:none}.view-btn.active{background:var(--accent);color:#fff}.view-btn:hover:not(.active){background:var(--surface2)}.nav-wrap{position:sticky;top:46px;z-index:89}.main-tabs-row{background:var(--bg2);border-bottom:1px solid var(--border);padding:0 24px}.main-tabs-inner{max-width:1600px;margin:0 auto;display:flex}.main-tab{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;letter-spacing:.6px;padding:14px 36px;background:transparent;border:none;color:var(--text3);cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-1px;transition:color .15s,border-color .15s,background .15s}.main-tab:hover{color:var(--text);background:var(--surface)}.main-tab.active{color:var(--text);background:var(--surface)}#tab-characters.active{border-bottom-color:#FF69B4;color:#FF69B4}#tab-weapons.active{border-bottom-color:#5aaa70;color:#5aaa70}#tab-accessories.active{border-bottom-color:#ff9500;color:#ff9500}#tab-other.active{border-bottom-color:var(--accent2);color:var(--text)}#tab-characters:hover{color:#FF69B4}#tab-weapons:hover{color:#5aaa70}#tab-accessories:hover{color:#ff9500}.sub-tabs-row{background:var(--bg3);border-bottom:2px solid var(--border);padding:0 24px;overflow-x:auto;scrollbar-width:none}.sub-tabs-row::-webkit-scrollbar{display:none}.sub-tabs-inner{max-width:1600px;margin:0 auto;display:flex}.sub-tab{white-space:nowrap;font-family:'Nunito',sans-serif;font-size:13px;font-weight:500;padding:9px 20px;background:transparent;border:none;color:var(--text2);cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;display:flex;align-items:center;gap:6px;transition:color .15s,border-color .15s,background .15s}.sub-tab:hover{color:var(--text);background:var(--surface)}.sub-tab.active{color:var(--text);background:var(--surface);border-bottom-color:var(--cat-color,var(--accent2))}.sub-tab-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}.sub-tab-count{font-size:10px;opacity:.5}.content{max-width:1600px;margin:0 auto;padding:18px 24px}.grid-view{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}.item-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:transform .15s,box-shadow .15s,border-color .15s;cursor:default;contain:layout style;position:relative;display:flex;flex-direction:column}.banned-ribbon{position:absolute;top:8px;right:8px;background:#7a1010;color:#ffaaaa;font-family:'Nunito',sans-serif;font-size:9px;font-weight:800;letter-spacing:.8px;text-transform:uppercase;padding:3px 7px;border-radius:4px;border:1px solid #c03030;z-index:10;pointer-events:none;box-shadow:0 1px 6px rgba(0,0,0,.5)}.tag-ribbon{position:absolute;right:8px;color:#fff;font-family:'Nunito',sans-serif;font-size:9px;font-weight:800;letter-spacing:.8px;text-transform:uppercase;padding:3px 7px;border-radius:4px;border:1px solid rgba(255,255,255,.25);z-index:10;pointer-events:none;box-shadow:0 1px 6px rgba(0,0,0,.5);filter:brightness(1.1)}.card-badge-row{display:flex;align-items:center;flex-wrap:wrap;gap:4px;margin-bottom:6px;min-height:20px}.card-id-row{display:flex;gap:5px;margin-bottom:6px;flex-wrap:wrap;align-items:center}.card-id-row .card-id-box{margin-left:auto}.stat-id-btn{display:flex;align-items:center;gap:5px;background:var(--bg);border:1px solid color-mix(in srgb,var(--stat-color,var(--border2)) 40%,var(--border2));border-radius:6px;padding:5px 8px;cursor:pointer;transition:all .15s;flex:1;min-width:0}.stat-id-btn:hover{border-color:var(--stat-color,var(--accent2));background:var(--surface2)}.stat-id-icon-img{width:14px;height:14px;object-fit:contain;image-rendering:pixelated;flex-shrink:0;opacity:.85}.stat-id-icon-fallback{font-size:10px;font-weight:800;color:var(--stat-color,var(--accent2));flex-shrink:0;line-height:1}.stat-id-num{font-family:'Share Tech Mono',monospace;font-size:11px;font-weight:700;color:var(--stat-color,var(--accent2));flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.stat-id-copy{flex-shrink:0;opacity:.35;color:var(--text3)}.stat-id-btn:hover .stat-id-copy{opacity:.8}.stat-id-btn:hover .stat-id-icon-img{opacity:1}.item-card:hover{transform:translateY(-2px);border-color:var(--cat-color,var(--border2));box-shadow:0 6px 20px rgba(0,0,0,.4),0 0 0 1px var(--cat-color,var(--accent))}.item-card[onclick]{cursor:pointer}.item-card[onclick]:hover{box-shadow:0 8px 24px rgba(0,0,0,.5),0 0 0 2px var(--cat-color,var(--accent));transform:translateY(-3px)}.card-top-bar{height:3px;background:var(--cat-color,var(--accent))}.card-icon-wrap{display:flex;align-items:center;justify-content:center;height:110px;background:var(--bg3);border-bottom:1px solid var(--border);overflow:hidden}.card-icon{max-width:96px;max-height:96px;object-fit:contain;image-rendering:pixelated}.card-body{padding:11px 12px;display:flex;flex-direction:column;flex:1}.card-name{font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600;color:var(--text);line-height:1.3}.card-id-box{font-family:'Nunito',sans-serif;font-size:11px;font-weight:700;color:var(--accent2);background:var(--bg);border:1px solid var(--border2);border-radius:6px;padding:4px 9px;cursor:pointer;transition:all .18s;letter-spacing:.3px;flex-shrink:0}.card-id-box:hover{border-color:var(--accent2);background:var(--surface2);color:#fff}.tbl-id{font-size:13px;padding:4px 9px;margin-bottom:0}.variants-toggle{width:100%;margin-top:6px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:5px 10px;font-size:11px;font-weight:600;color:var(--text2);cursor:pointer;text-align:left;transition:background .15s,color .15s}.variants-toggle:hover{background:var(--surface2);color:var(--text)}.weapon-info-hint{display:flex;align-items:center;justify-content:center;gap:5px;margin-top:auto;padding:6px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--text3);font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.4px;transition:all .15s;pointer-events:none}.weapon-info-hint svg{flex-shrink:0;opacity:.6}.item-card[onclick]:hover .weapon-info-hint{background:var(--accent);border-color:var(--accent);color:#fff}.item-card[onclick]:hover .weapon-info-hint svg{opacity:1}.tbl-variant{display:inline-flex;align-items:center;gap:3px;background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:3px 7px;cursor:pointer;transition:border-color .15s,background .15s}.tbl-variant:hover{border-color:var(--accent2);background:var(--surface2)}.card-desc{font-size:11px;color:var(--text2);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:8px}.badge{font-size:9px;font-weight:600;padding:2px 7px;border-radius:10px;text-transform:uppercase;letter-spacing:.4px}.badge-cat{color:#fff;background:var(--cat-color,var(--accent));filter:brightness(.85)}.table-wrap{overflow-x:auto;border-radius:var(--radius);border:1px solid var(--border)}table{width:100%;border-collapse:collapse;font-size:13px}thead tr{background:var(--surface2)}th{padding:10px 13px;text-align:left;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--text2);border-bottom:1px solid var(--border);white-space:nowrap;user-select:none;cursor:pointer}th:hover{color:var(--text)}tbody tr{border-bottom:1px solid var(--border);transition:background .1s}tbody tr:last-child{border-bottom:none}tbody tr:hover{background:var(--surface2)}td{padding:8px 13px;color:var(--text);vertical-align:middle}td.td-icon{width:44px;padding:4px 8px;text-align:center}td.td-icon img{width:32px;height:32px;object-fit:contain;image-rendering:pixelated;display:block;margin:0 auto}td.td-icon .no-icon{width:28px;height:28px;border-radius:5px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--text3);margin:0 auto}td.td-id{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text3);cursor:pointer;white-space:nowrap}td.td-id:hover{color:var(--accent2)}td.td-name{font-weight:500}td.td-file{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--text3);max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}td.td-desc{max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--text2);font-size:12px}.row-bar{display:inline-block;width:3px;height:13px;border-radius:2px;margin-right:7px;vertical-align:middle;background:var(--cat-color,var(--accent))}.empty{text-align:center;padding:70px 20px;color:var(--text3)}.empty svg{margin-bottom:14px;opacity:.35}.empty p{font-size:14px}.toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(10px);background:var(--surface2);border:1px solid var(--border2);color:var(--text);padding:9px 18px;border-radius:22px;font-size:12px;z-index:999;opacity:0;transition:all .25s;pointer-events:none;box-shadow:0 4px 16px rgba(0,0,0,.4)}.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--accent)}@media(max-width:640px){.content{padding:10px}.grid-view{grid-template-columns:repeat(2,1fr);gap:8px}.controls-inner{gap:6px}}@media(max-width:380px){.grid-view{grid-template-columns:1fr}}.weapon-modal{display:none;position:fixed;inset:0;z-index:500;background:rgba(0,0,0,.85);backdrop-filter:blur(4px);overflow-y:auto;padding:20px}.weapon-modal.open{display:flex;align-items:center;justify-content:center}.weapon-modal-content{background:var(--surface);border:2px solid var(--border2);border-radius:12px;max-width:700px;width:100%;max-height:85vh;overflow-y:auto;position:relative;box-shadow:0 10px 40px rgba(0,0,0,.6)}.weapon-modal-close{position:absolute;top:12px;right:12px;background:var(--bg3);border:1px solid var(--border2);color:var(--text);font-size:20px;width:32px;height:32px;border-radius:50%;cursor:pointer;transition:all .2s;z-index:10;display:flex;align-items:center;justify-content:center;line-height:1}.weapon-modal-close:hover{background:var(--accent2);border-color:var(--accent2);color:#fff;transform:rotate(90deg)}.weapon-modal-body{padding:20px}.weapon-display{text-align:center;border-bottom:2px solid var(--border);padding-bottom:16px;margin-bottom:16px}.weapon-image-container{min-height:150px;display:flex;align-items:center;justify-content:center;background:var(--bg3);border-radius:8px;padding:16px;margin-bottom:12px}.weapon-name{font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;color:var(--text);margin-bottom:6px}.weapon-desc{color:var(--text2);font-size:13px;line-height:1.5}.weapon-stats-title{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;color:var(--text);margin-bottom:10px;padding-bottom:6px;border-bottom:2px solid var(--border)}.weapon-stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:14px}.weapon-stat-item{background:var(--bg3);padding:10px;border-radius:6px;border:1px solid var(--border)}.weapon-stat-label{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px}.weapon-stat-value{font-family:'Share Tech Mono',monospace;font-size:18px;font-weight:700;color:var(--accent2)}.weapon-damage-section,.weapon-ammo-section{margin-top:12px;padding:10px;background:var(--bg2);border-radius:6px;border:1px solid var(--border)}.weapon-damage-title,.weapon-ammo-title{font-size:12px;font-weight:700;color:var(--text);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}.weapon-damage-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.weapon-damage-item{text-align:center}.weapon-damage-label{font-size:9px;color:var(--text3);margin-bottom:2px}.weapon-damage-value{font-family:'Share Tech Mono',monospace;font-size:14px;font-weight:700;color:var(--accent)}.weapon-ammo-info{display:flex;align-items:center;gap:10px;font-family:'Share Tech Mono',monospace;font-size:14px;color:var(--text)}.weapon-ammo-capacity{color:var(--accent2);font-weight:700}.weapon-ammo-separator{color:var(--text3)}.weapon-ammo-total{color:var(--accent);font-weight:700}.weapon-variants-title{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;color:var(--text);margin:16px 0 10px;padding-top:16px;border-top:2px solid var(--border)}.weapon-variant-selectors{background:var(--bg3);padding:14px;border-radius:8px;border:1px solid var(--border)}.variant-selector-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}.variant-selector-row label{font-size:12px;font-weight:600;color:var(--text);min-width:100px}.variant-selector-row select{flex:1;background:var(--surface);border:1px solid var(--border2);color:var(--text);padding:7px 10px;border-radius:6px;font-size:12px;cursor:pointer;transition:border-color .2s}.variant-selector-row select:hover,.variant-selector-row select:focus{border-color:var(--accent2)}.variant-result{display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface);border-radius:6px;border:1px solid var(--border2);margin-top:10px}.variant-result-label{font-size:12px;font-weight:600;color:var(--text)}.variant-result-id{font-family:'Share Tech Mono',monospace;font-size:16px;font-weight:700;color:var(--accent2);flex:1}.variant-copy-btn{background:var(--accent);border:none;color:#fff;padding:5px 14px;border-radius:6px;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}.variant-copy-btn:hover:not(:disabled){background:var(--accent2);transform:translateY(-1px)}.variant-copy-btn:disabled{opacity:.4;cursor:not-allowed}.changelog-modal{display:none;position:fixed;inset:0;z-index:600;background:rgba(0,0,0,.85);backdrop-filter:blur(4px);overflow-y:auto;padding:20px}.changelog-modal.open{display:flex;align-items:center;justify-content:center}.changelog-modal-content{background:var(--surface);border:2px solid var(--border2);border-radius:12px;max-width:600px;width:100%;max-height:80vh;overflow-y:auto;position:relative;box-shadow:0 10px 40px rgba(0,0,0,.6)}.changelog-modal-close{position:absolute;top:12px;right:12px;background:var(--bg3);border:1px solid var(--border2);color:var(--text);font-size:20px;width:32px;height:32px;border-radius:50%;cursor:pointer;transition:all .2s;z-index:10;display:flex;align-items:center;justify-content:center;line-height:1}.changelog-modal-close:hover{background:var(--accent2);border-color:var(--accent2);color:#fff;transform:rotate(90deg)}.changelog-header{padding:24px 24px 16px;border-bottom:2px solid var(--border);text-align:center}.changelog-title{font-family:'Rajdhani',sans-serif;font-size:26px;font-weight:700;color:var(--text);margin:0 0 8px}.changelog-version{font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--accent2);font-weight:700;letter-spacing:.5px}.changelog-body{padding:20px 24px 24px}.changelog-loading{text-align:center;padding:40px 20px;color:var(--text3);font-size:14px}.changelog-entry{margin-bottom:24px}.changelog-entry:last-child{margin-bottom:0}.changelog-entry-header{display:flex;align-items:baseline;gap:10px;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border)}.changelog-entry-version{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;color:var(--text)}.changelog-entry-date{font-size:11px;color:var(--text3);font-weight:600;letter-spacing:.3px}.changelog-changes{list-style:none;padding:0;margin:0}.changelog-change{display:flex;gap:10px;padding:6px 0;font-size:13px;line-height:1.6;color:var(--text2)}.changelog-change-badge{flex-shrink:0;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;padding:2px 6px;border-radius:4px;line-height:1.4}.changelog-change-badge.added{background:rgba(76,175,80,.15);color:#4caf50;border:1px solid rgba(76,175,80,.3)}.changelog-change-badge.improved{background:rgba(33,150,243,.15);color:#2196f3;border:1px solid rgba(33,150,243,.3)}.changelog-change-badge.fixed{background:rgba(255,152,0,.15);color:#ff9800;border:1px solid rgba(255,152,0,.3)}.changelog-change-badge.removed{background:rgba(244,67,54,.15);color:#f44336;border:1px solid rgba(244,67,54,.3)}.changelog-change-text{flex:1}@media(max-width:640px){.changelog-modal-content{max-width:100%;margin:10px}.changelog-header{padding:20px 20px 14px}.changelog-body{padding:16px 20px 20px}}@media(max-width:640px){.weapon-modal-content{max-width:100%;margin:10px}.weapon-stats-grid{grid-template-columns:1fr}.weapon-damage-grid{grid-template-columns:1fr}}</style>
</head>
<body>
<div id="loading-screen">
<div class="load-logo"><img src="assets/logo.webp" alt="ToyBattles"><div class="load-logo-text">ITEM DATABASE</div></div>
<div class="load-steps">
<div class="load-step" id="step-items">
<div class="step-dot"></div> Loading iteminfo.cdb.json
</div>
<div class="load-step" id="step-weapons">
<div class="step-dot"></div> Loading itemweaponsinfo.cdb.json
</div>
<div class="load-step" id="step-build">
<div class="step-dot"></div> Building catalog
</div>
</div>
<div class="load-bar-wrap"><div class="load-bar" id="load-bar"></div></div>
<div class="load-error" id="load-error"></div>
<button class="retry-btn" id="retry-btn" onclick="loadAllData()">‚Ü∫ Retry</button>
</div>
<div id="app" style="display:none">
<div class="site-hero">
<div class="site-hero-bg"></div>
<div class="site-hero-overlay"></div>
<div class="site-hero-inner">
<img class="site-logo" src="assets/logo.webp" alt="ToyBattles Logo">
<div class="site-title-block">
<div class="site-title"><span class="gold">Toy</span>Battles Item Database</div>
<div class="site-subtitle">Complete Item Reference</div>
</div>
<div style="flex:1"></div>
<button class="hero-btn reload-btn" onclick="loadAllData()" title="Reload data from JSON files">
<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
<path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
</svg>Reload Data
</button>
<button class="hero-btn theme-btn" id="theme-btn" title="Toggle light/dark theme">
<svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.2">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707M17.657 17.657l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/>
</svg><span id="theme-label">Light</span>
</button>
<button class="hero-btn" onclick="openChangelog()" title="View changelog">
<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.2">
<path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
</svg>What's New
</button>
</div>
</div>
<div class="stats-bar">
<div class="stats-inner">
<div class="stat"><span class="stat-num" id="stat-total">0</span><span class="stat-label">Total Items</span></div>
<div class="stat"><span class="stat-num" id="stat-showing">0</span><span class="stat-label">Families</span></div>
<div class="stat"><span class="stat-num" id="stat-cats">0</span><span class="stat-label">Categories</span></div>
<div class="stat" id="stat-icons-wrap" style="display:none"><span class="stat-num" id="stat-icons">0</span><span class="stat-label">With Icons</span></div>
</div>
</div>
<div class="controls">
<div class="controls-inner">
<div class="search-wrap">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
</svg>
<input type="text" id="search" placeholder="Search name, ID, description‚Ä¶">
</div>
<select id="filter-tag">
<option value="">All Tags</option>
</select>
<select id="filter-clothing-part" style="display:none" onchange="setClothingPart(this.value)">
<option value="All">All Slots</option>
<option value="Hair">Hair</option>
<option value="Face">Face</option>
<option value="Top">Top</option>
<option value="Skirt">Skirt</option>
<option value="Legs">Legs</option>
<option value="Shoes">Shoes</option>
<option value="Hands">Hands</option>
</select>
<select id="sort-by">
<option value="name-asc">Name (A‚ÄìZ)</option>
<option value="name-desc">Name (Z‚ÄìA)</option>
<option value="id-asc">ID (Low ‚Üí High)</option>
<option value="id-desc">ID (High ‚Üí Low)</option>
</select>

</div>
</div>
<div class="nav-wrap">
<div class="main-tabs-row">
<div class="main-tabs-inner">
<button class="main-tab active" id="tab-characters" onclick="setMainTab('characters')">
üë§ Characters
</button>
<button class="main-tab" id="tab-weapons" onclick="setMainTab('weapons')">
üî´ Weapons
</button>
<button class="main-tab" id="tab-accessories" onclick="setMainTab('accessories')">
üëú Accessories
</button>
<button class="main-tab" id="tab-other" onclick="setMainTab('other')">
üì¶ Other
</button>
</div>
</div>
<div class="sub-tabs-row" id="sub-tabs-row">
<div class="sub-tabs-inner" id="cat-strip"></div>
</div>
</div>
<div class="content">
<div id="items-container"></div>
</div>
</div>
<div class="toast" id="toast"></div>
<script>const CONFIG = {
ICONS_ENABLED: true,
ICON_EXT: '.png',
ICONS_DIR: 'assets/icons/',
DATA_FILES: {
items:   'data/iteminfo.cdb.json',
weaponItems: 'data/itemweaponsinfo.cdb.json',
weaponStats: 'data/weaponinfo.cdb.json',
icons:   'data/iconsinfo.cdb.json',
banned:  'data/banned.json',
tags:    'data/tags.json',
changelog: 'data/changelog.json'
}
};
const CATEGORIES = {
'Pandora': '#9900FF',
'Naomi': '#FF69B4',
'Kai': '#00CC44',
'CHIP': '#1155CC',
'Knox': '#FF6600',
'Simon': '#334488',
'Sophita': '#CCB800',
'Amelia': '#5aaa5a',
'Sharkill': '#CC2200',
'Accessories': '#00AAAA',
'Head Accessory': '#00CCCC',
'Back Accessory': '#00AAAA',
'Waist Accessory': '#008888',
'Melee': '#E63946',           // Vibrant Red
'Rifle': '#457B9D',           // Ocean Blue
'Shotgun': '#F77F00',         // Bright Orange
'Sniper': '#7209B7',          // Deep Purple
'MicroGun': '#06AED5',        // Cyan
'Bazooka': '#C1121F',         // Crimson Red
'Grenade Launcher': '#70E000', // Lime Green
'Other Items': '#607080',
'Banned Items': '#7a1010'
};
const UPGRADE_CONFIG = {
'Melee': {'5':'Power', '6':'Run Speed', '7':'Range'},
'Rifle': {'5':'Power', '6':'Accuracy', '7':'Ammo Capacity'},
'Shotgun': {'5':'Power', '6':'Firing Rate', '7':'Reload Speed'},
'Sniper': {'5':'Reload Speed','6':'Zoom Speed', '7':'Power'},
'MicroGun': {'5':'Warm Up Time','6':'Power', '7':'Run Speed'},
'Bazooka': {'5':'Firing Rate', '6':'Power', '7':'Projectile Speed'},
'Grenade Launcher': {'5':'Blast Radius','6':'Power', '7':'Firing Rate'}
};

// Accessory stat classification (based on ef_effect_1)
const SPEED_EFFECTS = new Set([20305, 20505, 20720, 20920, 21310, 21110]);
const HP_EFFECTS = new Set([32140, 32340, 32616, 32816, 33180, 32980]);
const AMMO_EFFECTS = new Map([
[40306, 'Sniper'],
[40209, 'Shotgun'],
[40509, 'Bazooka'],
[40406, 'MicroGun'],
[40106, 'Rifle'],
[40609, 'Grenade Launcher']
]);

// Weapon categories
const WEAPON_CATS = new Set(['Melee','Rifle','Shotgun','Sniper','MicroGun','Bazooka','Grenade Launcher']);

// Maps determineStatType() labels ‚Üí icon filenames in assets/icons/upgrades/
const STAT_ICON_MAP = {
'Run Speed':            'RunSpeed.png',
'HP':                   'HP.png',
'Sniper Ammo':          'Sniper.png',
'Shotgun Ammo':         'Shotgun.png',
'Bazooka Ammo':         'Bazooka.png',
'MicroGun Ammo':        'MicroGun.png',
'Rifle Ammo':           'Rifle.png',
'Grenade Launcher Ammo':'Grenade.png',
};
const STAT_COLOR_MAP = {
'Run Speed':             '#3a9eff',  // Blue
'HP':                    '#e05555',  // Red
'Melee Ammo':            '#F77F00',  // Orange
'Rifle Ammo':            '#FFD600',  // Yellow
'Shotgun Ammo':          '#B44FE8',  // Purple
'Sniper Ammo':           '#06AED5',  // Cyan
'MicroGun Ammo':         '#00C853',  // Green
'Bazooka Ammo':          '#FF4F8B',  // Pink
'Grenade Launcher Ammo': '#70E000',  // Lime
};

const TAB_GROUPS = {
characters: ['Pandora','Naomi','Kai','CHIP','Knox','Simon','Sophita','Amelia','Sharkill'],
weapons: ['Melee','Rifle','Shotgun','Sniper','MicroGun','Bazooka','Grenade Launcher'],
accessories: ['Head Accessory','Back Accessory','Waist Accessory'],
other: ['Other Items','Banned Items']
};
// Clothing slot detection: [label, ii_type, ii_type_inven]
const CLOTHING_PARTS = [
['Hair',  0, 11],
['Face',  1, 12],
['Top',   2, 13],
['Skirt', 4, 14],
['Legs',  3, 15],
['Shoes', 6, 17],
['Hands', 5, 16],
];
function getClothingPart(ii_type, ii_type_inven) {
for (const [label, t, ti] of CLOTHING_PARTS) {
if (ii_type === t || ii_type_inven === ti) return label;
}
return null;
}
let allItems = [];
let iconData = {};
let bannedIds = new Set();
let tagData = [];       // [{name, color, ids: Set}]
let tagMap = new Map(); // itemId ‚Üí [tagName, ...]
let weaponStatsMap = new Map();
let activeMainTab = 'characters';
let activeCategory = 'All';
let activeClothingPart = 'All';
function setStep(id, state) {
const el = document.getElementById(id);
el.classList.remove('active','done');
el.classList.add(state);
}
function setBar(pct) {
document.getElementById('load-bar').style.width = pct + '%';
}
function showLoadError(msg) {
const e = document.getElementById('load-error');
const b = document.getElementById('retry-btn');
if (e) {
e.innerHTML = '‚ùå Failed to load data<br><small style="opacity:.8;font-weight:400">' +
msg + '</small><br><small style="opacity:.6;font-weight:400;font-size:11px">Check that ' +
CONFIG.DATA_FILES.items + ' exists in your repo</small>';
e.style.display = 'block';
}
if (b) b.style.display = 'inline-block';
}
async function loadAllData() {
document.getElementById('app').style.display = 'none';
const ls = document.getElementById('loading-screen');
ls.style.display = 'flex'; ls.classList.remove('fade-out');
['step-items','step-weapons','step-build'].forEach(id => {
const el = document.getElementById(id);
el.classList.remove('active','done');
});
document.getElementById('load-error').style.display = 'none';
document.getElementById('retry-btn').style.display = 'none';
setBar(0);
try {
setStep('step-items','active'); setBar(5);
let itemsRaw;
try {
const r = await fetch(CONFIG.DATA_FILES.items);
if (!r.ok) throw new Error(`HTTP ${r.status}`);
itemsRaw = await r.json();
} catch(e) { throw new Error(`iteminfo.cdb.json ‚Äî ${e.message}`); }
setStep('step-items','done'); setBar(40);
setStep('step-weapons','active');
// Load weapon items (ii_id, ii_name, etc.)
let weaponItemsRaw = [];
try {
const r = await fetch(CONFIG.DATA_FILES.weaponItems);
if (!r.ok) throw new Error(`HTTP ${r.status}`);
weaponItemsRaw = await r.json();
} catch(e) {
console.warn('itemweaponsinfo.cdb.json not loaded:', e.message);
}
// Load weapon stats (wi_id, wi_ability_a, etc.)
weaponStatsMap = new Map();
try {
const r = await fetch(CONFIG.DATA_FILES.weaponStats);
if (!r.ok) throw new Error(`HTTP ${r.status}`);
const weaponStatsRaw = await r.json();
const weaponArr = Array.isArray(weaponStatsRaw) ? weaponStatsRaw : (weaponStatsRaw.items || weaponStatsRaw.data || []);
// Create lookup map by weapon ID
for (const weapon of weaponArr) {
if (weapon.wi_id) {
weaponStatsMap.set(String(weapon.wi_id), {
abilityA: weapon.wi_ability_a || 0,
abilityB: weapon.wi_ability_b || 0,
abilityC: weapon.wi_ability_c || 0,
abilityD: weapon.wi_ability_d || 0,
damHead: weapon.wi_dam_head || 0,
damUpper: weapon.wi_dam_upper || 0,
damUnder: weapon.wi_dam_under || 0,
bulletCapacity: weapon.wi_bullet_capacity || 0,
bulletTotal: weapon.wi_bullet_total || 0
});
}
}
console.log('Weapon stats loaded:', weaponStatsMap.size);
} catch(e) {
console.warn('weaponinfo.cdb.json not loaded:', e.message);
}
setStep('step-weapons','done'); setBar(72);
let iconsRaw = [];
try {
const r = await fetch(CONFIG.DATA_FILES.icons);
if (r.ok) iconsRaw = await r.json();
} catch(e) { }
bannedIds = new Set();
try {
const r = await fetch(CONFIG.DATA_FILES.banned);
if (r.ok) {
const raw = await r.json();
const arr = Array.isArray(raw) ? raw : (raw.items || raw.data || []);
for (const entry of arr) {
if (entry == null) continue;
if (typeof entry === 'number' || typeof entry === 'string') {
bannedIds.add(String(entry));
} else if (typeof entry === 'object') {
const val = entry.item_id ?? entry.id ?? entry.Item_ID ?? entry.ID ?? Object.values(entry)[0];
if (val != null) bannedIds.add(String(val));
}
}
console.log('Banned IDs loaded:', bannedIds.size);
}
} catch(e) { console.warn('banned.json not loaded:', e); }
// Load tags.json
tagData = [];
tagMap = new Map();
try {
const tr = await fetch(CONFIG.DATA_FILES.tags);
if (tr.ok) {
const tagsRaw = await tr.json();
if (Array.isArray(tagsRaw)) {
for (const tag of tagsRaw) {
if (!tag.name || !Array.isArray(tag.ids)) continue;
const idSet = new Set(tag.ids.map(String));
// Sanitize color - strip any extra leading # characters
const rawColor = tag.color || '#888888';
const color = '#' + rawColor.replace(/^#+/, '');
tagData.push({ name: tag.name, color, ids: idSet });
for (const id of idSet) {
if (!tagMap.has(id)) tagMap.set(id, []);
tagMap.get(id).push(tag.name);
}
}
console.log('Tags loaded:', tagData.length, 'tags');
}
}
} catch(e) { console.warn('tags.json not loaded:', e); }
setStep('step-build','active');
const norm = v => Array.isArray(v) ? v
: (v && Array.isArray(v.items)) ? v.items
: (v ? [v] : []);
const itemArr = norm(itemsRaw);
const weaponItemArr = norm(weaponItemsRaw);
const iconArr = norm(iconsRaw);
const seen = new Set();
const merged = [];
for (const item of [...itemArr, ...weaponItemArr]) {
const key = String(item.ii_id ?? '');
if (key && !seen.has(key)) { seen.add(key); merged.push(item); }
}
iconData = {};
for (const ic of iconArr) {
if (ic.ii_id == null) continue;
const sheetFile = String(ic.ii_filename || '').replace(/\.dds$/i, CONFIG.ICON_EXT);
const w = ic.ii_width || 102;
const h = ic.ii_height || 84;
const cols = Math.max(1, Math.floor((ic.ii_filesize || 512) / w));
const off = ic.ii_offset || 0;
iconData[String(ic.ii_id)] = {
sheet: CONFIG.ICONS_DIR + sheetFile,
x: (off % cols) * w,
y: Math.floor(off / cols) * h,
w, h,
sheetW: ic.ii_filesize || 512
};
}
function getWeaponStats(id, item, statsMap) {
// Quick lookups only during initial load (no expensive loops)
if (statsMap && statsMap.size > 0) {
// Try exact ID match (O(1) - fast)
let stats = statsMap.get(id);
if (stats) return stats;

// If root ID (ending in 00), try base variant (O(1) - fast)
if (id.endsWith('00')) {
const baseId = id.slice(0, -2) + '10';
stats = statsMap.get(baseId);
if (stats) return stats;
}

// Skip expensive prefix matching during initial load
// It will be done in the modal if needed
}

// Return empty stats structure (will be populated on modal open if needed)
return {
abilityA: 0,
abilityB: 0,
abilityC: 0,
abilityD: 0,
damHead: 0,
damUpper: 0,
damUnder: 0,
bulletCapacity: 0,
bulletTotal: 0
};
}
function getWeaponStatsComprehensive(id, statsMap) {
// Comprehensive lookup used ONLY in modal (includes expensive operations)
if (!statsMap || statsMap.size === 0) return null;

// Try exact ID match
let stats = statsMap.get(id);
if (stats) return stats;

// If root ID (ending in 00), try base variant (ending in 10)
if (id.endsWith('00')) {
const baseId = id.slice(0, -2) + '10';
stats = statsMap.get(baseId);
if (stats) {
console.log('Modal: Using stats from ' + baseId + ' for root ' + id);
return stats;
}
}

// Try prefix matching (expensive - only in modal)
const prefix = id.slice(0, 5);
for (const [statId, statData] of statsMap.entries()) {
if (statId.startsWith(prefix)) {
console.log('Modal: Using stats from ' + statId + ' for ' + id + ' (prefix match)');
return statData;
}
}

return null;
}
allItems = merged.map(item => {
const s = v => v != null ? String(v) : '';
const classFlags = {
a: item.ii_class_a || 0,
b: item.ii_class_b || 0,
c: item.ii_class_c || 0,
d: item.ii_class_d || 0,
e: item.ii_class_e || 0,
f: item.ii_class_f || 0,
g: item.ii_class_g || 0,
h: item.ii_class_h || 0,
i: item.ii_class_i || 0
};
const catResult = determineCategory(s(item.ii_meshfilename), classFlags, item.ii_type, item.ii_type_inven);
let category = catResult.category;
let characters = catResult.characters;
const upgrade = determineUpgrade(item.ii_id, category, item.ii_limited_time);
const name = s(item.ii_name);
// Override category for invalid/placeholder names
if (name.includes('????')) {
category = 'Other Items';
characters = [];
}
const iconKey = [item.ii_iconsmall, item.ii_icon, item.ii_id]
.filter(v => v != null)
.map(String)
.find(k => iconData[k]) || null;
const sprite = (CONFIG.ICONS_ENABLED && iconKey) ? iconData[iconKey] : null;
const id = item.ii_id != null ? String(item.ii_id) : '';
return {
id,
rootKey: Math.floor(Number(id) / 100) * 100,
name,
duration: s(item.ii_name_time).replace(/^duration:\s*/i, '').trim(),
upgrade,
file: s(item.ii_meshfilename),
desc: s(item.ii_desc),
category,
characters,
effect: item.ef_effect_1 != null ? Number(item.ef_effect_1) : 0,
nameOption: s(item.ii_name_option),
sprite,
classFlags,
weaponStats: getWeaponStats(id, item, weaponStatsMap),
clothingPart: getClothingPart(item.ii_type ?? null, item.ii_type_inven ?? null)
};
});
setStep('step-build','done'); setBar(100);
document.getElementById('stat-total').textContent = allItems.length.toLocaleString();
document.getElementById('stat-cats').textContent = new Set(allItems.map(i => i.category)).size;
if (CONFIG.ICONS_ENABLED) {
const withIcons = allItems.filter(i => i.sprite).length;
document.getElementById('stat-icons').textContent = withIcons.toLocaleString();
document.getElementById('stat-icons-wrap').style.display = '';
}
buildCategoryStrip();
buildTagDropdown();
resetFilters();
setTimeout(() => {
ls.classList.add('fade-out');
document.getElementById('app').style.display = 'block';
setTimeout(() => { ls.style.display = 'none'; }, 420);
}, 300);
} catch(err) {
showLoadError(err.message);
}
}
function determineCategory(filename, classFlags = {}, ii_type = null, ii_type_inven = null) {
if (!filename || !filename.trim()) return { category: 'Other Items', characters: [] };

// Force items/boxes (ii_type === 24/25 or ii_type_inven === 24/25/27) to Other Items
if (ii_type === 24 || ii_type === 25 || ii_type_inven === 24 || ii_type_inven === 25 || ii_type_inven === 27) return { category: 'Other Items', characters: [] };

const lower = filename.toLowerCase().trim().replace(/\\/g, '/');
const segments = lower.split('/');
const folder = segments[0];
const folderIs = kw => folder === kw || folder.startsWith(kw + '_');
const fullHas = kw => lower.includes(kw);

// Weapons (filename-based)
if (folderIs('sword') || fullHas('sword')) return { category: 'Melee', characters: [] };
if (folderIs('rifle') || fullHas('rifle')) return { category: 'Rifle', characters: [] };
if (folderIs('shotgun') || fullHas('shotgun')) return { category: 'Shotgun', characters: [] };
if (folderIs('sniper') || fullHas('sniper')) return { category: 'Sniper', characters: [] };
if (folderIs('gatling') || fullHas('gatling')) return { category: 'MicroGun', characters: [] };
if (folderIs('launcher') || fullHas('launcher')) return { category: 'Bazooka', characters: [] };
if (folderIs('grenade') || fullHas('grenade')) return { category: 'Grenade Launcher', characters: [] };

// Accessories (type or filename-based) with sub-categories
const isAcc = folder.startsWith('acc') || segments.some(s => s === 'acc');
if (isAcc || ii_type === 7 || ii_type === 8 || ii_type === 9 || 
    ii_type_inven === 19 || ii_type_inven === 20 || ii_type_inven === 21) {
// Determine accessory sub-category
// Head Accessory: ii_type=7 OR ii_type_inven=19 OR keywords
if (ii_type === 7 || ii_type_inven === 19 || 
    fullHas('glasses') || fullHas('hairpin') || fullHas('earring') || 
    fullHas('mask') || fullHas('head')) {
return { category: 'Head Accessory', characters: [] };
}
// Waist Accessory: ii_type=8 OR ii_type_inven=20 OR keywords
if (ii_type === 8 || ii_type_inven === 20 || fullHas('belt')) {
return { category: 'Waist Accessory', characters: [] };
}
// Back Accessory: ii_type=9 OR ii_type_inven=21 OR keywords
if (ii_type === 9 || ii_type_inven === 21 || fullHas('back')) {
return { category: 'Back Accessory', characters: [] };
}
// Default to general Accessories if no sub-category matched
return { category: 'Accessories', characters: [] };
}

// Character items (ii_class_* flags)
const classMap = {
a: 'Naomi',
b: 'Kai',
c: 'Pandora',
d: 'CHIP',
e: 'Knox',
f: 'Simon',
g: 'Amelia',
h: 'Sharkill',
i: 'Sophita'
};

// Get matching characters
const characters = Object.keys(classFlags)
.filter(key => classFlags[key] === 1)
.map(key => classMap[key])
.filter(Boolean);

if (characters.length > 0) {
return { category: characters[0], characters: characters };
}

// Fallback to old filename-based detection for backward compatibility
if (folderIs('gothloli') || fullHas('gothloli')) return { category: 'Pandora', characters: ['Pandora'] };
if (folderIs('girl') || fullHas('girl')) return { category: 'Naomi', characters: ['Naomi'] };
if (folderIs('elf') || fullHas('elf')) return { category: 'Amelia', characters: ['Amelia'] };
if (folderIs('sophitia') || folderIs('sophita') || fullHas('sophita')) return { category: 'Sophita', characters: ['Sophita'] };
if (folderIs('sharkill') || fullHas('sharkill')) return { category: 'Sharkill', characters: ['Sharkill'] };
if (folderIs('simon') || fullHas('simon')) return { category: 'Simon', characters: ['Simon'] };
if (folderIs('monster') || fullHas('monster')) return { category: 'CHIP', characters: ['CHIP'] };
if (folderIs('mechanic') || fullHas('mechanic')) return { category: 'Knox', characters: ['Knox'] };
if (folderIs('guy')) return { category: 'Kai', characters: ['Kai'] };

return { category: 'Other Items', characters: [] };
}
function determineUpgrade(itemId, category, limitedTime) {
const idStr = String(itemId ?? '');
const isWeapon = WEAPON_CATS.has(category);

// For clothing and accessories: IGNORE ii_upgradable entirely
// Only use ii_limited_time to determine unlimited status
if (!isWeapon) {
// ii_limited_time === 0 means the item is unlimited/permanent
if (limitedTime === 0 || limitedTime === '0') return 'Unlimited';
return 'Not unlimited/Not Upgradable';
}

// WEAPONS ONLY ‚Äî use digit-based detection
// Check for Unlimited weapons first (tens digit in UPGRADE_CONFIG)
const ups = UPGRADE_CONFIG[category];
if (ups && idStr.length >= 2) {
const tensDigit = idStr.slice(-2, -1);
const onesDigit = idStr.slice(-1);
const upgradeType = ups[tensDigit];
if (upgradeType) {
return `Unlimited - ${upgradeType} Level ${onesDigit}`;
}
}
// Check for regular upgradable weapons (50-59 range)
if (idStr.length >= 2) {
const lastTwo = parseInt(idStr.slice(-2), 10);
if (lastTwo >= 50 && lastTwo <= 59) return 'Upgradable';
}
return 'Not unlimited/Not Upgradable';
}
function buildTagDropdown() {
const sel = document.getElementById('filter-tag');
const current = sel.value;
sel.innerHTML = '<option value="">All Tags</option>' +
tagData.map(t => `<option value="${esc(t.name)}" style="color:${esc(t.color)}">${esc(t.name)}</option>`).join('');
if (current) sel.value = current;
}
function setMainTab(tab) {
activeMainTab = tab;
activeCategory = 'All';
activeClothingPart = 'All';
// Show clothing part dropdown only on characters tab
const partFilter = document.getElementById('filter-clothing-part');
if (partFilter) {
partFilter.style.display = (tab === 'characters') ? '' : 'none';
partFilter.value = 'All';
}
document.querySelectorAll('.main-tab').forEach(b =>
b.classList.toggle('active', b.id === 'tab-' + tab));
buildCategoryStrip();
render();
}
function setClothingPart(part) {
activeClothingPart = part;
render();
}
function buildCategoryStrip() {
const tabCats = TAB_GROUPS[activeMainTab] || [];
const counts = {};
allItems.forEach(i => { 
counts[i.category] = (counts[i.category] || 0) + 1;
// Also count items in their character categories
if (i.characters && i.characters.length > 0) {
i.characters.forEach(char => {
if (char !== i.category) { // Don't double-count the primary category
counts[char] = (counts[char] || 0) + 1;
}
});
}
});
const tabTotal = allItems.filter(i => 
tabCats.includes(i.category) || 
(i.characters && i.characters.some(char => tabCats.includes(char)))
).length;
const strip = document.getElementById('cat-strip');
let html = `<button class="sub-tab active" data-cat="All"
onclick="setCategory('All')" style="--cat-color:var(--accent2)">
<span class="sub-tab-dot" style="background:var(--accent2)"></span>
All
<span class="sub-tab-count">(${tabTotal.toLocaleString()})</span>
</button>`;
tabCats.forEach(name => {
if (!counts[name]) return;
const color = CATEGORIES[name] || '#607080';
html += `<button class="sub-tab" data-cat="${name}"
onclick="setCategory('${esc(name)}')" style="--cat-color:${color}">
<span class="sub-tab-dot" style="background:${color}"></span>
${esc(name)}
<span class="sub-tab-count">(${counts[name].toLocaleString()})</span>
</button>`;
});
strip.innerHTML = html;
}
function setCategory(cat) {
activeCategory = cat;
document.querySelectorAll('.sub-tab').forEach(b =>
b.classList.toggle('active', b.dataset.cat === cat));
render();
}
let familyGroups = [];
function groupByFamilyRoot(items) {
const map = new Map();
for (const item of items) {
const key = item.rootKey;
if (!map.has(key)) {
map.set(key, { rootKey: key, name: '', desc: '', category: item.category, characters: item.characters || [], sprite: null, variants: [] });
}
const g = map.get(key);
if (Number(item.id) === key) { g.name = item.name; g.desc = item.desc; g.sprite = item.sprite; g.characters = item.characters || []; }
if (!g.sprite && item.sprite) g.sprite = item.sprite;
g.variants.push({ 
id: item.id, 
duration: item.duration, 
upgrade: item.upgrade, 
name: item.name, 
desc: item.desc,
category: item.category, 
effect: item.effect || 0, 
nameOption: item.nameOption || '',
weaponStats: item.weaponStats
});
}
for (const g of map.values()) {
if (!g.name) { 
g.name = g.variants[0].name; 
// Try to find a variant with a description
const variantWithDesc = g.variants.find(v => v.desc);
g.desc = variantWithDesc ? variantWithDesc.desc : '';
}
g.variants.sort((a, b) => Number(a.id) - Number(b.id));
}

// Deduplicate weapons with same name - keep the one with upgrades
const groups = [...map.values()];

// Helper function to check if a group has upgradable variants
function hasUpgrades(group) {
return group.variants.some(v => {
const upgrade = v.upgrade || '';
// Check if it's upgradable (50-59 range) or unlimited
return upgrade.includes('Upgradable') || upgrade.includes('Unlimited');
});
}

// Group by name to find duplicates
const nameMap = new Map();
for (const group of groups) {
// Only deduplicate weapons
if (!WEAPON_CATS.has(group.category)) {
nameMap.set(group.rootKey, group); // Non-weapons: use rootKey as unique identifier
continue;
}

const name = group.name.toLowerCase().trim();
if (!nameMap.has(name)) {
nameMap.set(name, group);
} else {
// Duplicate found - compare upgrade availability
const existing = nameMap.get(name);
const existingHasUpgrades = hasUpgrades(existing);
const currentHasUpgrades = hasUpgrades(group);

// Keep the one with upgrades
if (currentHasUpgrades && !existingHasUpgrades) {
// Current has upgrades, existing doesn't - replace
console.log(`Deduplicating "${group.name}": keeping ${group.rootKey} (has upgrades), removing ${existing.rootKey} (no upgrades)`);
nameMap.set(name, group);
} else if (!currentHasUpgrades && existingHasUpgrades) {
// Existing has upgrades, current doesn't - keep existing
console.log(`Deduplicating "${group.name}": keeping ${existing.rootKey} (has upgrades), removing ${group.rootKey} (no upgrades)`);
// Do nothing, keep existing
} else {
// Both have upgrades or both don't - keep the one with lower rootKey (original)
if (group.rootKey < existing.rootKey) {
console.log(`Deduplicating "${group.name}": keeping ${group.rootKey} (lower ID), removing ${existing.rootKey}`);
nameMap.set(name, group);
}
}
}
}

return [...nameMap.values()];
}
function getFiltered() {
const q = document.getElementById('search').value.toLowerCase().trim();
const tag = document.getElementById('filter-tag').value;
const srt = document.getElementById('sort-by').value;
let items = allItems;
const tabCats = TAB_GROUPS[activeMainTab] || [];
items = items.filter(i => 
tabCats.includes(i.category) || 
(i.characters && i.characters.some(char => tabCats.includes(char)))
);
if (activeCategory !== 'All') {
items = items.filter(i => 
i.category === activeCategory || 
(i.characters && i.characters.includes(activeCategory))
);
}
// Clothing slot filter (characters tab only)
if (activeMainTab === 'characters' && activeClothingPart !== 'All') {
items = items.filter(i => i.clothingPart === activeClothingPart);
}
if (q) items = items.filter(i =>
i.name.toLowerCase().includes(q) ||
String(i.id).includes(q) ||
i.desc.toLowerCase().includes(q) ||
i.file.toLowerCase().includes(q)
);
if (tag) {
const tagObj = tagData.find(t => t.name === tag);
if (tagObj) {
// Build a map of rootKey ‚Üí all item IDs in that family (from current filtered items)
const rootToIds = new Map();
items.forEach(i => {
if (!rootToIds.has(i.rootKey)) rootToIds.set(i.rootKey, []);
rootToIds.get(i.rootKey).push(String(i.id));
});

// Find root families where at least one tagged ID actually exists in that family
const matchingRoots = new Set();
for (const [rootKey, ids] of rootToIds) {
if (ids.some(id => tagObj.ids.has(id))) {
matchingRoots.add(rootKey);
}
}

// Include ALL items from matching root families
items = items.filter(i => matchingRoots.has(i.rootKey));
}
}
return [...items].sort((a, b) => {
switch(srt) {
case 'name-asc': return a.name.localeCompare(b.name);
case 'name-desc': return b.name.localeCompare(a.name);
case 'id-asc': return Number(a.id) - Number(b.id);
case 'id-desc': return Number(b.id) - Number(a.id);
}
return 0;
});
}
function resetFilters() {
document.getElementById('search').value = '';
document.getElementById('filter-tag').value = '';
document.getElementById('sort-by').value = 'name-asc';
activeMainTab = 'characters';
activeCategory = 'All';
activeClothingPart = 'All';
const partFilter = document.getElementById('filter-clothing-part');
if (partFilter) { partFilter.style.display = ''; partFilter.value = 'All'; }
document.querySelectorAll('.main-tab').forEach(b =>
b.classList.toggle('active', b.id === 'tab-characters'));
buildCategoryStrip();
render();
}
function render() {
const items = getFiltered();
const groups = groupByFamilyRoot(items);
familyGroups = groups;
const cont = document.getElementById('items-container');
document.getElementById('stat-showing').textContent = groups.length.toLocaleString();
if (!groups.length) {
cont.innerHTML = `<div class="empty">
<svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
</svg>
<p>No items match your filters.</p></div>`;
return;
}
renderGrid(groups, cont);
}
function iconHtml(item, size) {
if (CONFIG.ICONS_ENABLED && item.sprite) {
const sp = item.sprite;
const dim = size === 'card' ? 96 : size === 'chip' ? 28 : 30;
const scale = dim / Math.max(sp.w, sp.h);
const sw = Math.round(sp.w * scale);
const sh = Math.round(sp.h * scale);
const bx = -Math.round(sp.x * scale);
const by = -Math.round(sp.y * scale);
const bsW = Math.round(sp.sheetW * scale);
const style = [
`width:${sw}px`,`height:${sh}px`,
`background-image:url('${sp.sheet}')`,
`background-position:${bx}px ${by}px`,
`background-size:${bsW}px auto`,
`image-rendering:pixelated`,
`display:inline-block`,`flex-shrink:0`
].join(';');
return `<span class="${size==='card'?'card-icon':''}" style="${style}" title="${esc(item.name)}"></span>`;
}
const color = CATEGORIES[item.category] || '#607080';
const dim = size === 'card' ? 80 : size === 'chip' ? 28 : 26;
const fs = size === 'card' ? 32 : size === 'chip' ? 14 : 13;
const style = [
`width:${dim}px`,`height:${dim}px`,
`border-radius:${size==='card'?8:5}px`,
`background:${color}22`,`border:1px solid ${color}55`,
`display:flex`,`align-items:center`,`justify-content:center`,
`font-size:${fs}px`,`color:${color}`,`flex-shrink:0`
].join(';');
return `<span style="${style}">${(item.name||'?')[0].toUpperCase()}</span>`;
}
const BATCH = 200;
function renderGrid(groups, cont) {
const wrap = document.createElement('div');
wrap.className = 'grid-view';
cont.innerHTML = '';
cont.appendChild(wrap);
let idx = 0;
function paint() {
const end = Math.min(idx + BATCH, groups.length);
const frag = document.createDocumentFragment();
const tmp = document.createElement('div');
let html = '';
for (let i = idx; i < end; i++) html += gridCard(groups[i], i);
tmp.innerHTML = html;
while (tmp.firstChild) frag.appendChild(tmp.firstChild);
wrap.appendChild(frag);
idx = end;
if (idx < groups.length) requestAnimationFrame(paint);
}
paint();
}
const WEAPON_STAT_LABELS = {
'Melee': {a: 'Power', b: 'Range', c: 'Run Speed', d: 'Secondary Power'},
'Rifle': {a: 'Power', b: 'Firing Rate', c: 'Accuracy', d: 'Reload Speed'},
'Shotgun': {a: 'Power', b: 'Firing Rate', c: 'Accuracy', d: 'Reload Speed'},
'Sniper': {a: 'Power', b: 'Firing Rate', c: 'Zoom Speed', d: 'Reload Speed'},
'MicroGun': {a: 'Power', b: 'Warm Up Time', c: 'Run Speed', d: 'Accuracy'},
'Bazooka': {a: 'Power', b: 'Firing Rate', c: 'Blast Radius', d: 'Bullet Speed'},
'Grenade Launcher': {a: 'Power', b: 'Firing Rate', c: 'Blast Radius', d: 'Reload Speed'}
};
const CHAR_UPGRADE_MAP = {
'0': 'Unlimited - Run Speed',
'1': 'Unlimited - Health',
'2': 'Unlimited - Run Speed',
'3': 'Unlimited - Health'
};
function statTypeOf(effect, nameOption) {
if (SPEED_EFFECTS.has(effect)) return 'speed';
if (HP_EFFECTS.has(effect)) return 'hp';
const ammo = AMMO_EFFECTS.get(effect);
if (ammo) return 'ammo:' + ammo;
if (effect === 0 && (nameOption || '').trim() === 'No Option') return null;
const norm = (nameOption || '').toLowerCase().replace(/\s/g, '');
if (norm.includes('runspeed')) return 'speed';
if (norm.includes('hp')) return 'hp';
return null;
}
function variantLabel(v) {
const idStr = String(v.id);
const isUnlimited = (v.duration || '').toLowerCase().includes('unlimited');
const dur = v.duration || 'Permanent';
const isWeapon = WEAPON_CATS.has(v.category);
const isAcc = v.category === 'Accessories' || v.category === 'Head Accessory' || 
              v.category === 'Back Accessory' || v.category === 'Waist Accessory';
if (isWeapon) {
if (isUnlimited && idStr.length >= 2) {
const ups = UPGRADE_CONFIG[v.category];
if (ups) {
const tensDigit = idStr.slice(-2, -1); // Second-to-last digit
const onesDigit = idStr.slice(-1); // Last digit
const upgradeType = ups[tensDigit];
if (upgradeType) {
return `Unlimited - ${upgradeType} Level ${onesDigit}`;
}
}
}
return dur;
}
if (isAcc) {
const st = statTypeOf(v.effect || 0, v.nameOption || '');
if (st && st.startsWith('ammo:')) return `${dur} ‚Äî ${st.slice(5)} Ammo`;
if (st === 'speed') return `${dur} ‚Äî Run Speed`;
if (st === 'hp') return `${dur} ‚Äî HP`;
return dur;
}
if (isUnlimited && idStr.length >= 1) {
const lastOne = idStr.slice(-1);
if (CHAR_UPGRADE_MAP[lastOne]) return CHAR_UPGRADE_MAP[lastOne];
}
const st = statTypeOf(v.effect || 0, v.nameOption || '');
if (st === 'speed') return `${dur} ‚Äî Run Speed`;
if (st === 'hp') return `${dur} ‚Äî HP`;
return dur;
}
function dedupeVariants(variants) {
const map = new Map();
for (const v of variants) {
const lbl = variantLabel(v);
if (!map.has(lbl)) {
map.set(lbl, { label: lbl, primary: v, extras: [] });
} else {
map.get(lbl).extras.push(v);
}
}
return [...map.values()];
}
function buildVariantChips(group, deduped, color) {
return deduped.map(dg => {
const vid = String(dg.primary.id);
const lbl = dg.label;
return `<div class="vc-chip" style="--cat-color:${color}" onclick="copyId('${vid}');event.stopPropagation()" title="${esc(lbl)} ‚Äî click to copy ID">` +
iconHtml(group, 'chip') +
`<div class="chip-info">` +
`<span class="chip-label">${esc(lbl)}</span>` +
`</div></div>`;
}).join('');
}
function gridCard(group, gid) {
const color = CATEGORIES[group.category] || '#607080';
const rootId = String(group.rootKey);
const deduped = dedupeVariants(group.variants);
const uCount = deduped.length;
const chipsHtml = uCount > 1 ? buildVariantChips(group, deduped, color) : '';
const isBanned = bannedIds.has(rootId) || group.variants.some(v => bannedIds.has(String(v.id)));
const isWeapon = WEAPON_CATS.has(group.category);

// Collect tags for this group (check root and all variant IDs)
const groupTags = [];
const checkedTags = new Set();
const allGroupIds = [rootId, ...group.variants.map(v => String(v.id))];
for (const tag of tagData) {
if (checkedTags.has(tag.name)) continue;
if (allGroupIds.some(id => tag.ids.has(id))) {
groupTags.push(tag);
checkedTags.add(tag.name);
}
}

// Build character pills or fallback to category badge
let badgeHtml = '';
if (group.characters && group.characters.length > 0) {
// Show character pills with gap
badgeHtml = '<div style="display:flex;gap:4px;flex-wrap:wrap">' +
group.characters.map(char => {
const charColor = CATEGORIES[char] || '#607080';
return `<span class="badge badge-cat" style="--cat-color:${charColor}">${esc(char)}</span>`;
}).join('') +
'</div>';
} else {
// Show single category badge
badgeHtml = `<span class="badge badge-cat" style="--cat-color:${color}">${esc(group.category)}</span>`;
}

const cardClick = isWeapon 
? `onclick="openWeaponModal(${gid})" style="cursor:pointer"` 
: `onclick="openClothingModal(${gid})" style="cursor:pointer"`;

// For clothing/accessories: detect unlimited variants (tens=5) and show per-stat ID buttons
// ALL cards use the same 2-row structure: [badge row] then [id row]
let idRowHtml = '';
if (!isWeapon) {
const statButtons = [];
const seenLabels = new Set();

// First, try to find tens=5 variants in the current group
let variantsToCheck = group.variants;
const hasUnlimitedInGroup = variantsToCheck.some(v => String(v.id).slice(-2, -1) === '5');

// If no unlimited variants in this group, search other groups with the same name
if (!hasUnlimitedInGroup && group.name) {
const matchingGroup = familyGroups.find(g => 
g.name === group.name && 
g.rootKey !== group.rootKey &&
g.variants.some(v => String(v.id).slice(-2, -1) === '5')
);
if (matchingGroup) {
variantsToCheck = matchingGroup.variants;
}
}

// Now build stat buttons from the selected variant pool
variantsToCheck.forEach(v => {
const idStr = String(v.id);
if (idStr.slice(-2, -1) !== '5') return; // only unlimited (tens=5)
const label = determineStatType(v.effect, v.nameOption);
if (!label || seenLabels.has(label)) return;
seenLabels.add(label);
const iconFile = STAT_ICON_MAP[label] || null;
const statColor = STAT_COLOR_MAP[label] || 'var(--accent2)';
statButtons.push({ id: v.id, label, iconFile, statColor });
});

if (statButtons.length > 0) {
idRowHtml = statButtons.map(s => {
const iconHtmlStr = s.iconFile
? `<img class="stat-id-icon-img" src="assets/icons/upgrades/${s.iconFile}" alt="${esc(s.label)}" title="${esc(s.label)}">`
: `<span class="stat-id-icon-fallback">${esc(s.label[0])}</span>`;
return `<div class="stat-id-btn" style="--stat-color:${s.statColor}" onclick="copyId('${s.id}');event.stopPropagation()" title="${esc(s.label)} ‚Äî click to copy">` +
iconHtmlStr +
`<span class="stat-id-num">${s.id}</span>` +
`<svg class="stat-id-copy" width="9" height="9" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>` +
`</div>`;
}).join('');
} else {
idRowHtml = `<div class="card-id-box" onclick="copyId('${rootId}');event.stopPropagation()" title="Click to copy root ID">${esc(rootId)}</div>`;
}
} else {
idRowHtml = `<div class="card-id-box" onclick="copyId('${rootId}');event.stopPropagation()" title="Click to copy root ID">${esc(rootId)}</div>`;
}

const footerHtml =
`<div class="card-badge-row">${badgeHtml}</div>` +
`<div class="card-id-row">${idRowHtml}</div>`;

return `<div class="item-card" data-gid="${gid}" style="--cat-color:${color}" ${cardClick}>` +
(isBanned ? `<div class="banned-ribbon">‚õî Banned Item</div>` : '') +
(groupTags.length > 0 ? groupTags.map((t, i) =>
`<div class="tag-ribbon" style="background:${t.color};top:${isBanned ? 30 + i*22 : 8 + i*22}px">${esc(t.name)}</div>`
).join('') : '') +
`<div class="card-top-bar"></div>` +
`<div class="card-icon-wrap">${iconHtml(group,'card')}</div>` +
`<div class="card-body">` +
`<div class="card-name">${esc(group.name)||'(no name)'}</div>` +
(group.desc ? `<div class="card-desc">${esc(group.desc)}</div>` : '') +
footerHtml +
`<div class="weapon-info-hint">` +
`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">` +
`<circle cx="12" cy="12" r="10"></circle>` +
`<path d="M12 16v-4M12 8h.01"></path>` +
`</svg>` +
`<span>Click for ${isWeapon ? 'stats &' : 'duration &'} upgrades</span>` +
`</div>` +
`</div>` +
`</div>`;
}
function toggleVariants(gid, btn) {
const isOpen = btn.dataset.open === '1';
const drawer = document.getElementById('vgd-' + gid);
if (!drawer) return;
const uCount = dedupeVariants(familyGroups[gid].variants).length;
if (isOpen) {
btn.dataset.open = '0';
drawer.classList.remove('open');
btn.innerHTML = `&#9662; Show ${uCount} variants`;
} else {
btn.dataset.open = '1';
drawer.classList.add('open');
btn.innerHTML = `&#9652; Hide ${uCount} variants`;
}
}
let dark = true;
let searchTimer;
try {
const tb1 = document.getElementById('theme-btn');
if (tb1) tb1.addEventListener('click', () => {
dark = !dark;
document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
const lbl = document.getElementById('theme-label');
const ico = document.getElementById('theme-icon');
if (lbl) lbl.textContent = dark ? 'Light' : 'Dark';
if (ico) ico.innerHTML = dark
? '<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707M17.657 17.657l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/>'
: '<path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
});
const srch = document.getElementById('search');
if (srch) srch.addEventListener('input', () => {
clearTimeout(searchTimer); searchTimer = setTimeout(render, 180);
});
const ft = document.getElementById('filter-tag');
const sb = document.getElementById('sort-by');
if (ft) ft.addEventListener('change', render);
if (sb) sb.addEventListener('change', render);
} catch(initErr) {
console.error('Init error (non-fatal):', initErr);
}
function copyId(id) {
navigator.clipboard.writeText(String(id)).catch(() => {
const t = document.createElement('textarea');
t.value = String(id); document.body.appendChild(t);
t.select(); document.execCommand('copy'); t.remove();
});
showToast('üìã Copied: ' + id);
}
function showToast(msg) {
const t = document.getElementById('toast');
t.textContent = msg; t.classList.add('show');
setTimeout(() => t.classList.remove('show'), 2200);
}
function esc(s) {
return String(s)
.replace(/&/g,'&amp;').replace(/</g,'&lt;')
.replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
let currentWeaponGroup = null;
function openWeaponModal(gid) {
const group = familyGroups[gid];
if (!group || !WEAPON_CATS.has(group.category)) return;
currentWeaponGroup = group;
const modal = document.getElementById('weapon-modal');
const weaponData = group.variants[0]; // Use first variant for base stats
// Set weapon image
const imgContainer = document.getElementById('weapon-modal-image');
imgContainer.innerHTML = iconHtml(group, 'card');
// Set weapon name and description
document.getElementById('weapon-modal-name').textContent = group.name;
document.getElementById('weapon-modal-desc').textContent = group.desc || 'No description available.';
// Build stats grid
const labels = WEAPON_STAT_LABELS[group.category];
// Try to get stats from variant, or lookup by root ID
let stats = weaponData.weaponStats || group.variants[0]?.weaponStats;
// If stats are all zeros or missing, do comprehensive lookup
if (!stats || (stats.abilityA === 0 && stats.abilityB === 0 && stats.abilityC === 0 && stats.abilityD === 0)) {
const rootId = String(group.rootKey);
stats = getWeaponStatsComprehensive(rootId, weaponStatsMap);
if (!stats) {
console.warn('Modal: No stats found for ' + rootId);
// Use empty stats
stats = {
abilityA: 0,
abilityB: 0,
abilityC: 0,
abilityD: 0,
damHead: 0,
damUpper: 0,
damUnder: 0,
bulletCapacity: 0,
bulletTotal: 0
};
}
}
if (stats && labels) {
const statsGrid = document.getElementById('weapon-stats-grid');
statsGrid.innerHTML = `
<div class="weapon-stat-item">
<div class="weapon-stat-label">${labels.a}</div>
<div class="weapon-stat-value">${stats.abilityA}</div>
</div>
<div class="weapon-stat-item">
<div class="weapon-stat-label">${labels.b}</div>
<div class="weapon-stat-value">${stats.abilityB}</div>
</div>
<div class="weapon-stat-item">
<div class="weapon-stat-label">${labels.c}</div>
<div class="weapon-stat-value">${stats.abilityC}</div>
</div>
<div class="weapon-stat-item">
<div class="weapon-stat-label">${labels.d}</div>
<div class="weapon-stat-value">${stats.abilityD}</div>
</div>
`;
} else {
const statsGrid = document.getElementById('weapon-stats-grid');
statsGrid.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text3)">' +
'<p>No weapon stats available for this item.</p>' +
'<p style="font-size:11px;margin-top:8px">ID: ' + group.rootKey + '</p>' +
'</div>';
console.warn('Modal: Cannot display stats. stats=' + !!stats + ', labels=' + !!labels);
}
// Damage section
const damageSection = document.getElementById('weapon-damage-section');
if (stats && (stats.damHead || stats.damUpper || stats.damUnder)) {
damageSection.innerHTML = `
<div class="weapon-damage-title">Damage</div>
<div class="weapon-damage-grid">
<div class="weapon-damage-item">
<div class="weapon-damage-label">Head</div>
<div class="weapon-damage-value">${stats.damHead}</div>
</div>
<div class="weapon-damage-item">
<div class="weapon-damage-label">Upper</div>
<div class="weapon-damage-value">${stats.damUpper}</div>
</div>
<div class="weapon-damage-item">
<div class="weapon-damage-label">Lower</div>
<div class="weapon-damage-value">${stats.damUnder}</div>
</div>
</div>
`;
damageSection.style.display = 'block';
} else {
damageSection.style.display = 'none';
}
// Ammo section
const ammoSection = document.getElementById('weapon-ammo-section');
if (stats && (stats.bulletCapacity || stats.bulletTotal)) {
const totalBullets = stats.bulletCapacity + stats.bulletTotal;
ammoSection.innerHTML = `
<div class="weapon-ammo-title">Ammunition</div>
<div class="weapon-ammo-info">
<span class="weapon-ammo-capacity">${stats.bulletCapacity}</span>
<span class="weapon-ammo-separator">/</span>
<span class="weapon-ammo-total">${stats.bulletTotal}</span>
<span class="weapon-ammo-separator">=</span>
<span style="color:var(--text2)">${totalBullets} total</span>
</div>
`;
ammoSection.style.display = 'block';
} else {
ammoSection.style.display = 'none';
}
// Populate upgrade type dropdown
const upgradeConfig = UPGRADE_CONFIG[group.category];
const typeSelect = document.getElementById('variant-upgrade-type');
typeSelect.innerHTML = '<option value="">Select Type</option>';
if (upgradeConfig) {
Object.keys(upgradeConfig).forEach(key => {
typeSelect.innerHTML += `<option value="${key}">${upgradeConfig[key]}</option>`;
});
}
// Populate duration dropdown from unlimited variants only
const durSelect = document.getElementById('variant-duration');
const durMap = new Map(); // duration label ‚Üí tens digits that produce it
if (upgradeConfig) {
group.variants.forEach(v => {
const idStr = String(v.id);
const tens = idStr.slice(-2, -1);
if (!upgradeConfig[tens]) return; // only unlimited variants
const dur = (v.duration || 'Unlimited').trim();
if (!dur.includes('?')) {
if (!durMap.has(dur)) durMap.set(dur, []);
durMap.get(dur).push(tens);
}
});
}
durSelect.innerHTML = '<option value="">Select Duration</option>' +
[...durMap.keys()].map(d => `<option value="${esc(d)}">${esc(d)}</option>`).join('');
// Reset variant selection
document.getElementById('variant-duration').value = '';
document.getElementById('variant-upgrade-level').value = '0';
document.getElementById('variant-result-id').textContent = '-';
document.getElementById('variant-result-id').style.color = 'var(--accent2)';
document.getElementById('variant-copy-btn').disabled = true;
modal.classList.add('open');
}
function closeWeaponModal() {
document.getElementById('weapon-modal').classList.remove('open');
currentWeaponGroup = null;
}
function closeWeaponModalBackdrop(event) {
if (event.target === event.currentTarget) {
closeWeaponModal();
}
}
async function loadChangelog() {
try {
const response = await fetch(CONFIG.DATA_FILES.changelog);
if (!response.ok) throw new Error('Failed to load changelog');
return await response.json();
} catch (error) {
console.warn('Changelog not available:', error);
return null;
}
}
function openChangelog() {
const modal = document.getElementById('changelog-modal');
modal.classList.add('open');
// Load changelog if not already loaded
loadChangelog().then(data => {
if (!data) {
document.getElementById('changelog-body').innerHTML = 
'<div class="changelog-loading">Changelog not available.</div>';
return;
}
// Display current version
document.getElementById('changelog-current-version').textContent = 
'Version ' + data.currentVersion + ' ‚Ä¢ ' + data.lastUpdated;
// Build changelog HTML
let html = '';
for (const entry of data.entries) {
html += '<div class="changelog-entry">';
html += '<div class="changelog-entry-header">';
html += '<span class="changelog-entry-version">v' + entry.version + '</span>';
html += '<span class="changelog-entry-date">' + entry.date + '</span>';
html += '</div>';
html += '<ul class="changelog-changes">';
for (const change of entry.changes) {
html += '<li class="changelog-change">';
html += '<span class="changelog-change-badge ' + change.type + '">' + change.type + '</span>';
html += '<span class="changelog-change-text">' + change.text + '</span>';
html += '</li>';
}
html += '</ul>';
html += '</div>';
}
document.getElementById('changelog-body').innerHTML = html;
});
}
function closeChangelog() {
document.getElementById('changelog-modal').classList.remove('open');
}
function closeChangelogBackdrop(event) {
if (event.target === event.currentTarget) {
closeChangelog();
}
}
let currentClothingGroup = null;
function determineStatType(effect, nameOption) {
// RULE #1: Check ef_effect_1 first (authoritative)
if (SPEED_EFFECTS.has(effect)) {
return 'Run Speed';
}
if (HP_EFFECTS.has(effect)) {
return 'HP';
}
const ammoWeapon = AMMO_EFFECTS.get(effect);
if (ammoWeapon) {
return `${ammoWeapon} Ammo`;
}

// RULE #2: Fallback to text parsing if effect is 0 or unknown
if (effect === 0 || !effect) {
// Check for "No Option" case
if (nameOption && nameOption.trim() === 'No Option') {
return null; // No stat
}
// Parse the text
if (nameOption) {
const normalized = nameOption.toLowerCase().replace(/\s/g, '');
if (normalized.includes('runspeed')) return 'Run Speed';
if (normalized.includes('hp')) return 'HP';
}
}

// RULE #3: Unknown
return null;
}

function openClothingModal(gid) {
const group = familyGroups[gid];
if (!group) return;
currentClothingGroup = group;
const modal = document.getElementById('clothing-modal');
document.getElementById('clothing-modal-name').textContent = group.name;
document.getElementById('clothing-modal-desc').textContent = group.desc || 'No description available.';
document.getElementById('clothing-modal-image').innerHTML = iconHtml(group, 'card');

// ID structure: [base][tens = duration digit][ones = stat type digit]
// e.g. 1322350 ‚Üí base=13223, tens=5 (Unlimited), ones=0 (Run Speed)
//      1322351 ‚Üí base=13223, tens=5 (Unlimited), ones=1 (HP)

const durationMap = new Map(); // tens digit ‚Üí duration label
const statMap = new Map();     // label ‚Üí Set of ones digits

group.variants.forEach(v => {
const idStr = String(v.id);
if (idStr.length < 2) return;
const tens = idStr.slice(-2, -1);
const ones = idStr.slice(-1);
if (tens === '0' && ones === '0') return; // skip root

// tens ‚Üí duration
if (!durationMap.has(tens) && v.duration && !v.duration.includes('?')) {
durationMap.set(tens, v.duration.trim());
}

// label ‚Üí ones digits (dedupe by label, not by digit)
const label = determineStatType(v.effect, v.nameOption);
if (label) {
if (!statMap.has(label)) statMap.set(label, new Set());
statMap.get(label).add(ones);
}
});

const sortedDur = [...durationMap.entries()].sort((a, b) => Number(a[0]) - Number(b[0]));

// Duration dropdown: value = tens digit
const durationSelect = document.getElementById('clothing-duration');
durationSelect.innerHTML = '<option value="">Select Duration</option>' +
sortedDur.map(([d, label]) => `<option value="${d}">${esc(label)}</option>`).join('');

// Stat type dropdown: value = JSON array of all ones digits for that label
const typeSelect = document.getElementById('clothing-upgrade-type');
typeSelect.innerHTML = '<option value="">Select Stat Type</option>' +
[...statMap.entries()].map(([label, onesSet]) =>
`<option value="${esc(JSON.stringify([...onesSet]))}">` + esc(label) + `</option>`
).join('');

document.getElementById('clothing-result-id').textContent = '-';
document.getElementById('clothing-result-id').style.color = 'var(--accent2)';
document.getElementById('clothing-copy-btn').disabled = true;
modal.classList.add('open');
}
function closeClothingModal() {
document.getElementById('clothing-modal').classList.remove('open');
currentClothingGroup = null;
}
function closeClothingBackdrop(event) {
if (event.target === event.currentTarget) {
closeClothingModal();
}
}
function updateClothingID() {
if (!currentClothingGroup) return;
const tensDigit = document.getElementById('clothing-duration').value;
const onesValue = document.getElementById('clothing-upgrade-type').value; // JSON array of ones digits
const resultEl = document.getElementById('clothing-result-id');
const copyBtn = document.getElementById('clothing-copy-btn');

if (!tensDigit || !onesValue) {
resultEl.textContent = '-';
resultEl.style.color = 'var(--accent2)';
copyBtn.disabled = true;
return;
}

// Parse the ones digits array for this stat type
let onesDigits = [];
try { onesDigits = JSON.parse(onesValue); } catch(e) { onesDigits = [onesValue]; }

const rootStr = String(currentClothingGroup.rootKey);
const baseId = rootStr.slice(0, -2);

// Try each ones digit ‚Äî find the first real variant that exists in data
let match = null;
for (const ones of onesDigits) {
const candidateId = baseId + tensDigit + ones;
match = currentClothingGroup.variants.find(v => String(v.id) === candidateId);
if (match) break;
}

if (match) {
resultEl.textContent = match.id;
resultEl.style.color = 'var(--accent2)';
copyBtn.disabled = false;
} else {
resultEl.textContent = '‚ö† No match found';
resultEl.style.color = '#ff8c42';
copyBtn.disabled = true;
}
}
function copyClothingID() {
const text = document.getElementById('clothing-result-id').textContent;
// Only copy if it's a clean numeric ID (no warning suffix)
const id = text.split(' ')[0];
if (id && id !== '-' && !isNaN(id)) {
copyId(id);
}
}
function updateVariantID() {
if (!currentWeaponGroup) return;
const selectedDur = document.getElementById('variant-duration').value;
const tensDigit = document.getElementById('variant-upgrade-type').value;
const onesDigit = document.getElementById('variant-upgrade-level').value;
const resultEl = document.getElementById('variant-result-id');
const copyBtn = document.getElementById('variant-copy-btn');

if (!tensDigit) {
resultEl.textContent = '-';
copyBtn.disabled = true;
return;
}

const baseID = String(currentWeaponGroup.rootKey);
const baseId = baseID.slice(0, -2);
const candidateId = baseId + tensDigit + onesDigit;

// Verify against real variants
const match = currentWeaponGroup.variants.find(v => String(v.id) === candidateId);

// If duration selected, also verify duration matches
if (match && selectedDur && match.duration && match.duration.trim() !== selectedDur) {
resultEl.textContent = '‚ö† No match found';
resultEl.style.color = '#ff8c42';
copyBtn.disabled = true;
return;
}

if (match) {
resultEl.textContent = match.id;
resultEl.style.color = 'var(--accent2)';
copyBtn.disabled = false;
} else {
resultEl.textContent = '‚ö† No match found';
resultEl.style.color = '#ff8c42';
copyBtn.disabled = true;
}
}
function copyVariantID() {
const idText = document.getElementById('variant-result-id').textContent;
if (idText && idText !== '-' && !idText.includes('‚ö†')) copyId(idText);
}
loadAllData();</script>
<div id="weapon-modal" class="weapon-modal" onclick="closeWeaponModalBackdrop(event)">
<div class="weapon-modal-content">
<button class="weapon-modal-close" onclick="closeWeaponModal()">‚úï</button>
<div class="weapon-modal-body">
<div class="weapon-display">
<div class="weapon-image-container" id="weapon-modal-image"></div>
<h2 class="weapon-name" id="weapon-modal-name"></h2>
<p class="weapon-desc" id="weapon-modal-desc"></p>
</div>
<div class="weapon-stats-panel">
<h3 class="weapon-stats-title">Weapon Stats</h3>
<div class="weapon-stats-grid" id="weapon-stats-grid"></div>
<div class="weapon-damage-section" id="weapon-damage-section"></div>
<div class="weapon-ammo-section" id="weapon-ammo-section"></div>
</div>
<div class="weapon-variants-section">
<h3 class="weapon-variants-title">Select Upgrade</h3>
<div class="weapon-variant-selectors">
<div class="variant-selector-row">
<label>Duration:</label>
<select id="variant-duration" onchange="updateVariantID()">
<option value="">Select Duration</option>
</select>
</div>
<div class="variant-selector-row">
<label>Upgrade Type:</label>
<select id="variant-upgrade-type" onchange="updateVariantID()">
<option value="">Select Type</option>
</select>
</div>
<div class="variant-selector-row">
<label>Upgrade Level:</label>
<select id="variant-upgrade-level" onchange="updateVariantID()">
<option value="0">Level 0</option>
<option value="1">Level 1</option>
<option value="2">Level 2</option>
<option value="3">Level 3</option>
<option value="4">Level 4</option>
<option value="5">Level 5</option>
<option value="6">Level 6</option>
<option value="7">Level 7</option>
<option value="8">Level 8</option>
<option value="9">Level 9</option>
</select>
</div>
<div class="variant-result">
<span class="variant-result-label">Item ID:</span>
<span class="variant-result-id" id="variant-result-id">-</span>
<button class="variant-copy-btn" onclick="copyVariantID()" id="variant-copy-btn" disabled>Copy ID</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="clothing-modal" class="weapon-modal" onclick="closeClothingBackdrop(event)">
<div class="weapon-modal-content" style="max-width:600px">
<button class="weapon-modal-close" onclick="closeClothingModal()" title="Close">√ó</button>
<div class="weapon-modal-body">
<div class="weapon-display">
<div class="weapon-image-container" id="clothing-modal-image"></div>
<h2 class="weapon-name" id="clothing-modal-name">Item Name</h2>
<p class="weapon-desc" id="clothing-modal-desc">Description</p>
</div>
<h3 class="weapon-variants-title">Item Variants</h3>
<div class="weapon-variant-selectors">
<div class="variant-selector-row">
<label>Duration:</label>
<select id="clothing-duration" onchange="updateClothingID()">
<option value="">Select Duration</option>
</select>
</div>
<div class="variant-selector-row">
<label>Stat Type:</label>
<select id="clothing-upgrade-type" onchange="updateClothingID()">
<option value="">Select Stat Type</option>
</select>
</div>
<div class="variant-result">
<span class="variant-result-label">Item ID:</span>
<span class="variant-result-id" id="clothing-result-id">-</span>
<button class="variant-copy-btn" onclick="copyClothingID()" id="clothing-copy-btn" disabled>Copy ID</button>
</div>
</div>
</div>
</div>
</div>
<div id="changelog-modal" class="changelog-modal" onclick="closeChangelogBackdrop(event)">
<div class="changelog-modal-content">
<button class="changelog-modal-close" onclick="closeChangelog()" title="Close">√ó</button>
<div class="changelog-header">
<h2 class="changelog-title">What's New</h2>
<div class="changelog-version" id="changelog-current-version">Loading...</div>
</div>
<div class="changelog-body" id="changelog-body">
<div class="changelog-loading">Loading changelog...</div>
</div>
</div>
</div>
<div id="toast" class="toast"></div>
</body>
</html>